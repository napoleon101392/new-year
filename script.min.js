const SECONDS_PER_MINUTE=60;const SECONDS_PER_HOUR=3600;const SECONDS_PER_DAY=86400;let countdownInterval=null;let fireworksInstance=null;const elements={countdownContainer:null,countdownHeading:null,timer:null,days:null,hours:null,minutes:null,seconds:null,daysLabel:null,hoursLabel:null,minutesLabel:null,secondsLabel:null,startButton:null,celebrateButton:null,disclaimerMessage:null,fireworksContainer:null,fireworksSound:null};const initializeElements=()=>{elements.countdownContainer=document.getElementById('countdownContainer');elements.countdownHeading=document.getElementById('countdownHeading');elements.timer=document.getElementById('timer');elements.days=document.getElementById('days');elements.hours=document.getElementById('hours');elements.minutes=document.getElementById('minutes');elements.seconds=document.getElementById('seconds');elements.daysLabel=document.getElementById('days-label');elements.hoursLabel=document.getElementById('hours-label');elements.minutesLabel=document.getElementById('minutes-label');elements.secondsLabel=document.getElementById('seconds-label');elements.startButton=document.getElementById('startButton');elements.celebrateButton=document.getElementById('celebrateNowButton');elements.disclaimerMessage=document.getElementById('disclaimerMessage');elements.fireworksContainer=document.getElementById('fireworks');elements.fireworksSound=document.getElementById('fireworksSound')};const getYearFromUrl=()=>{const urlParams=new URLSearchParams(window.location.search);const year=urlParams.get('year');return year?parseInt(year,10):new Date().getFullYear()+1};const updateHeading=(year)=>{if(elements.countdownHeading){elements.countdownHeading.textContent=`Countdown to New Year ${year}`}};const toggleElementDisplay=(element,label,show)=>{if(element&&label){const parentTimeUnit=element.closest('.time-unit');if(parentTimeUnit){parentTimeUnit.style.display=show?'flex':'none'}
if(show){element.textContent=element.textContent||'0'}}};const updateCountdownDisplay=(days,hours,minutes,seconds)=>{const showDays=days>0;const showHours=hours>0||showDays;const showMinutes=minutes>0||showHours;elements.days.textContent=days;toggleElementDisplay(elements.days,elements.daysLabel,showDays);elements.hours.textContent=hours;toggleElementDisplay(elements.hours,elements.hoursLabel,showHours);elements.minutes.textContent=minutes;toggleElementDisplay(elements.minutes,elements.minutesLabel,showMinutes);elements.seconds.textContent=seconds;toggleElementDisplay(elements.seconds,elements.secondsLabel,!0)};const hideStartControls=()=>{elements.startButton?.classList.add('hidden');elements.celebrateButton?.classList.add('hidden');if(elements.disclaimerMessage){elements.disclaimerMessage.style.display='none'}};const countdown=()=>{const year=getYearFromUrl();updateHeading(year);const countDate=new Date(`Jan 1, ${year} 00:00:00`).getTime();const now=Date.now();const totalSeconds=Math.floor((countDate-now)/1000);if(totalSeconds<=0){clearInterval(countdownInterval);countdownInterval=null;elements.countdownContainer?.classList.add('hidden');document.getElementById('celebration')?.classList.remove('hidden');startFireworks();return}
const days=Math.floor(totalSeconds/SECONDS_PER_DAY);const hours=Math.floor((totalSeconds%SECONDS_PER_DAY)/SECONDS_PER_HOUR);const minutes=Math.floor((totalSeconds%SECONDS_PER_HOUR)/SECONDS_PER_MINUTE);const seconds=totalSeconds%SECONDS_PER_MINUTE;updateCountdownDisplay(days,hours,minutes,seconds)};const startFireworks=()=>{const skyline=document.querySelector('.city-skyline');if(skyline){skyline.style.transition='filter 1s ease';skyline.style.filter='brightness(1.3) drop-shadow(0 0 15px rgba(255, 255, 255, 0.4))'}
if(fireworksInstance)return;fireworksInstance=new Fireworks.default(elements.fireworksContainer,{acceleration:1.05,friction:0.95,gravity:1.2,particles:150,traceLength:5,traceSpeed:18,explosion:10,intensity:50,flickering:70,lineStyle:'round',hue:{min:0,max:360},delay:{min:15,max:35},rocketsPoint:{min:50,max:50},lineWidth:{explosion:{min:2,max:7},trace:{min:1,max:4}},brightness:{min:70,max:95},decay:{min:0.008,max:0.02},mouse:{click:!0,move:!1,max:5}});if(elements.fireworksSound){elements.fireworksSound.loop=!0;elements.fireworksSound.play().catch(err=>console.log('Audio autoplay prevented:',err))}
fireworksInstance.start();elements.fireworksContainer.classList.add('active');elements.fireworksContainer.style.filter='brightness(1.3) contrast(1.2) saturate(1.4)';elements.fireworksContainer.style.mixBlendMode='screen'};const startCountdown=()=>{document.getElementById('welcomeScreen')?.classList.add('hidden');elements.countdownContainer?.classList.remove('hidden');countdown();countdownInterval=setInterval(countdown,1000)};const celebrateNow=()=>{hideStartControls();document.getElementById('welcomeScreen')?.classList.add('hidden');if(countdownInterval){clearInterval(countdownInterval);countdownInterval=null}
elements.countdownContainer?.classList.add('hidden');document.getElementById('celebration')?.classList.remove('hidden');startFireworks()};const setupEventListeners=()=>{elements.startButton?.addEventListener('click',()=>{hideStartControls();startCountdown()});elements.celebrateButton?.addEventListener('click',celebrateNow)};const init=()=>{initializeElements();setupEventListeners()};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init)}else{init()}